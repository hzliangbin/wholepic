###  容器技术对比虚拟机的技术优势

1. 容器的运行基于进程而非虚拟机，无需模拟操作系统。启动速度快，占用资源少，有利于计算资源全部向应用倾斜，降低硬件成本。
2. 容器基于Linux Namespace技术格力进程，是用户进程可以拥有独立的网络配置，文件系统，用户空间，进程空间等等。虽然容器只是一个应用，但因为有较好的隔离性，其行为甚至可以模拟虚拟机。
3. 容器基于LInux Control Group技术，对用户进程进行资源限定，可以为每一个容器实力分配CPU，内存，磁盘IO等资源上限，能够隔离同一主机上多个用户进程之间的干扰。
4. 容器的镜像的打包和分发方式相比虚拟机而言，要优雅很多。Docker支持Dockerfile，允许用户像管理源代码一样管理容器镜像文件，容器镜像是面向业务应用而不是面向操作系统的。
5. 镜像支持分层的文件结构。当构建容器镜像时，Dockerfile中的每一行命令都是一个文件层级，一个镜像就是多个文件层的集合。容器运行时会按照镜像层级由下到上按层家在，是镜像打包时的逆操作，由此实现一次打包，处处运行。
6. 每个文件层都有基于其内容计算出来的Digest，文件分发时，如果某个文件层未发生变化，无需重新拉取，由此解决增量文件部署的问题。无论基础镜像有多大，只要基础镜像不更新，则更新镜像版本时，只会拉取变更的部分，不会过多消耗带宽。
7. 容器镜像可以上传到镜像仓库，通过不同的tag进行版本管理。解决镜像的存储和分发问题。



### kubernetes扮演的角色和核心竞争力

1. 集群管理。以计算节点为核心的，管理成规模集群的数据中心级别的操作系统。k8s作为云平台，首先要监控和管理这些节点的健康状况和可用资源。
2. 作业调度和作业管理。支持不同的存储方式；自动可控的升级和回退；高利用率的调度机制；有效的自愈机制；密码和配置管理。
3. 服务发现和服务治理。容器能够利用DNS和集群IP地址想集群内外提供服务。在分发流量的时候，能够打高负载均衡，避免出现某个容器流量过高的情况。

核心竞争力：

1. 声明式系统。命令式系统基于同步交互，用户执行一条命令或调用一个接口，阻塞并等待响应返回，再依次执行后续命令或调用。声明式系统通常对业务进行抽象，所有请求都可以通过源码形式保存起来。不同版本的业务对象可以在代码仓库中保存，可以对版本进行溯源。声明式系统追求的是最终一致性，整个系统做成了异步调用。K8S最核心的优势是，将其解决的问题领域中所有的对象做了非常好的抽象，计算节点抽象成node，运行应用抽象成pod，可供访问的应有服务抽象成service。
2. 控制器模式。k8s中每种抽象出来的对象，都有其对应的控制器组件。每个控制器坚挺其所关注的对象的变更，然后按照对象中最新的期望状态进行系统配置，配置完成后，更新该对象的实际状态。
3. 插件化框架。k8s追求的目标是成为业界通用的解决方案。提供了不同的插件化框架，有容器运行接口、容器存储接口、容器网络接口，使得不同企业可以按需定制方案。比如企业有统一的认证系统，k8s则避免重复造轮子，它提供了多种认证接口。
4. 标准化推动。k8s提供基于自定义资源的对象扩展能力。定义扩展的资源对象，可以尝试解决更多业界问题。比如微软在主导开放应用模型（OAM）中尝试解决的问题是应用定义的标准化，比如谷歌主导的Istio服务网格尝试解决的问题是流量管理标准化，比如谷歌主导的knative尝试解决的问题是无服务器架构。



###  模型设计中的GKV

TypeMeta是K8s对象中最基本的定义。通过Group把不同功能范围对象归入不同分组，是对象的可维护性和可理解性更高。

Kind定义一个对象的基本类型。Version属性则负责控制版本。当不同版本的对象定义发生变更时，有可能会涉及数据迁移。api-server允许通过Conversion方法转换不同版本的对象属性。这是一种自动迁移数据的机制。



### Label和Annotation的区别

Label，在传统的面向对象设计系统中，对象组合的方法通常是内嵌或引用，即将对象A内嵌到B中，或者将A的ID内嵌到B对象中。这种设计的弊端是固化的，如果一个对象可能对多个其它对象发生关联，当该对象发生变更时，系统需要遍历所有其关联对象并做修改。

k8s通过label和selector来管理对象和对象之间的松耦合关系。一个对象可以有任意对标签，存在形式就是键值对。其它对象只需要定义label selector就可以了按条件查询出其需要关联的对象。Label的查询可以基于等式或集合。

Annotation和label一样用键值对来定义。功能不同。API不支持只用Annotation来做条件过滤，在生产落地中，需要保存一些在对象内置属性中无法保存的信息，Annotation就是用于满足这类需求的，事实上Annotation就是对象属性的扩展。更多的是面向系统管理人员和开发人员的。比如，为Pod标记Annotation以告知Prometheus为其抓取系统指标。

### Finalizer 和 ResourceVersion

Finalizer是一个十分重要的属性。当k8s和企业系统、资源整合时候，需要操作这些集群的外部资源。当用户创建了一个k8s对象，假设对应的控制器需要从外部系统获取资源，当用户删除对象时，控制器接收删除事件后，会尝试释放该资源。假如此时外部系统无法联通，同时控制器发生了重启，就会造成该对象永久泄漏。

  





























































































































